# 던전11(DungeonEleven / A11조)

다양한 패턴의 던전이 나오고, 아이템을 주워서 판매해 케릭터를 성장시키는 로그라이크 게임입니다.

## 시연 영상
[![Video Label](http://img.youtube.com/vi/dt7GvhOIzxU/0.jpg)](https://youtu.be/dt7GvhOIzxU)

위 사진을 클릭 시 시연 영상 링크로 이동합니다.


<br/>

## 팀원 / 담당 파트


|이름|담당 업무|깃허브 링크|
|------|---|---|
|임전혁|팀장|[링크](https://github.com/yarogono)|
|김명식|팀원|[링크](https://github.com/D0ryeon)|
|이경민|팀원|[링크](https://github.com/kminsmin)|
|윤지석|팀원|[링크](https://github.com/noyyo)|



<br/>


## 프로젝트 설계


### 패키지 구조도

<img src="https://github.com/yarogono/DungeonEleven/assets/70641418/3ad8f7c4-3420-4ff0-a996-c27bcf3abfed">

<br/>
<br/>

### 와이어 프레임(Figma)

<img src="https://github.com/yarogono/DungeonEleven/assets/70641418/dee80154-2dcf-49ea-8fe7-cbb13f1423df">

<br/>

## 문제에 대한 고민과 해결 과정


<details>
<summary>[임전혁] </summary>
<div markdown="1">

- 반복되는 싱글톤 코드
  - 제네릭 클래스를 사용해서 커스텀 싱글톤 클래스를 구현했습니다. 구현한 제네릭 싱글톤 클래스를 상속 받으면 싱글톤 처리가 되도록 했습니다. ⇒ [참고 링크](https://github.com/yarogono/DungeonEleven/pull/4)
- MP3 파일의 유니티 성능 이슈
  - 유니티에서 WAV 파일을 사용하는 것을 권장합니다. MP3 파일은 유니티 빌드 시간 동안 압축을 풀고 다시 압축을 하는 손실이 발생한다고 해서 WAV 파일로 변경했습니다. ⇒ [참고 링크](https://github.com/yarogono/DungeonEleven/issues/49)
- 아이템 데이터를 클라이언트, 서버 중 어디서 관리할 것인가에 대한 고민
  - DataManager를 사용해서 Item 데이터를 Json 형식으로 관리하고 있습니다. 이 부분을 서버쪽에서 관리해서 필요한 정보를 패킷으로 클라이언트에게 전송해줄 것인가에 대한 고민을 했습니다. 
결론적으로 클라이언트에서 세부적인 아이템 정보를 가지고 있고 서버에서는 해당 아이템 ID 값만 플레이어에게 저장하는 방식을 도입했습니다. ⇒ [해당 코드 PR 링크](https://github.com/yarogono/DungeonEleven/pull/44)
- 서버에서 플레이어 데이터를 Json으로 저장 시 어떻게 식별할 것인지에 대한 고민
  - 각각 다른 컴퓨터에서 접속을 해서 서버와 통신을 하는데 로그인 기능 없이 어떻게 식별할지 고민하다가 유저 컴퓨터의 공용 IP로 식별하는 방식을 도입해 봤습니다.
⇒ [해당 코드 PR 링크](https://github.com/yarogono/DungeonEleven/pull/53)

</div>
</details>

<details>
<summary>[이경민] </summary>
<div markdown="1">

- 맵 이동 구현에 대한 고민
  - 맵 오브젝트들의 배열을 MapManager가 들고 있습니다.
  - 플레이어가 포탈에 다가가서 특정 인풋 입력 시 배열의 다음 인덱스의 맵을 활성화하고, 현재 맵을 비활성화합니다.
- 맵 랜덤 생성에 대한 고민
  - DungeonScene 로드 시, MapManager에게 있는 맵의 배열의 순서를 랜덤으로 섞는 방식으로 구현했습니다. 맨 마지막 인덱스의 맵은 자동으로 보스 맵으로 향하는 맵이 됩니다.
- 플레이어의 콜라이더가 맵의 발판과 충돌하여 의도처럼 이동하지 못하는 현상
  - 피격 판정을 담당하는 트리거와, 플레이어의 발 부분만을 감싸는 콜라이더를 따로 구분하여 만들고, 점프시 발 콜라이더를 임시로 비활성화하여 공중에서는 발판과 충돌하지 않도록 구현했습니다.
- 몬스터 AI에 대한 고민
  - 주변에 플레이어가 있을 때와 없을 때 다르게 행동합니다.
  - 0부터 10 사이의 난수를 생성하고, 해당 난수의 범위에 따라 행동 양식을 결정하고 switch문으로 각각의 행동 양식에 따라 행동하도록 구현했습니다. 코루틴을 사용해서 이를 반복적으로 수행하도록 했습니다.
- 보스 패턴에 대한 고민
  - 기본적으로 몬스터와 같은 원리이지만, 남은 체력도 반영하여 행동 양식을 결정하도록 변경했습니다. MonsterController를 상속받고, 코루틴 부분만을 오버라이드하여 구현했습니다.

</div>
</details>

<details>
<summary>[윤지석] </summary>
<div markdown="1">

- 아이템 슬롯에 필요한 기능
  - 아이템 슬롯에서 좀 더 직관적인 UX를 제공하면 좋겠다고 생각했고 하이라이트 기능과 선택, 교환의 기능등을 IPointerHandler나 IDragHandelr로 구현했습니다.
추가적으로 정렬에 대한 기능 구현도 필요했는데 아이템 슬롯 자체를 바꿀지, 슬롯 내부의 데이터만 바꿀지 고민하다가 슬롯이 바뀌면 슬롯 인덱스에 관련해서 또 한번의 관리가 필요할 것 같아 내부의 데이터만 바꾸는 방식으로 구현했습니다.
- UIManager를 어떻게 구현할 것인가
  - 실시간으로 UI들이 나타났다 사라지는 것이 아닌 씬이 바뀌면서 스토어씬에서 집중적으로 UI로 상호작용하다보니 UIManager에 대한 필요성이 적었고 UI들을 프리팹화 시켜서 사용할 필요성도 적었습니다.
어떻게 구현할지 고민하다가 UIManager는 구현하되 매니저 단에서 UI를 생성하고 관리하는 것이 아니라 씬에서 매니저에 직접 등록하고 매니저는 끄고 키는 관리만 하도록 구현했습니다.
- 어울리지 않거나 부족한 점이 있는 애셋들
  - UI에 사용할 여러가지 애셋을 다운받았지만 필요한 부분이 없거나 부족했습니다. 다른 애셋들과 섞어서 쓰자니 어울리지 않는 것들이 많았고 결국 기본 UI를 가지고 만들어서 쓰기로 했습니다.

</div>
</details>

<details>
<summary>[김명식] </summary>
<div markdown="1">

- 강의처럼 스크립트를 세부적으로 나누어서 작업을 하려고 했는데 나누어서 작업한건 작동하지 않아서 일단MovementController에 모든 움직임과 애니메이션 동작을 구현함
  - 튜터님이 옵저버 패턴을 공부해보면 보일거라고 조언해주셔서 옵저버 패턴 공부 중, C# 기초에 대한 공부도 부족한것 같아서 따로 공부할 예정
- 떨어지는 동작을 구현할 때 Rigidbody에 Velocity.y값이 증가함에 따라 떨어지는 동작이 작동하게 구현해봤는데 한번 점프가 끝나도 계속 떨어지는 모션을 취하고 있는 이슈가 있었음 
  - Rigidbody에 중력 값을 받아오게 되면 y값이 3개나 나오게 되어서 계속 떨어지는 것이 아닌가 하는 생각이 들어서 다른방식으로 false처리함
RaycastHit2D를 사용해 캐릭터 아래쪽으로 짧게 빔을 쏴서 걸리는 오브젝트가 있으면 false로 바꾸게 만듬
</div>
</details>
